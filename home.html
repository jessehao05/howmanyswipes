<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Home</title>
</head>
<body>
    <div class="form-container">
        <div class="title">Meal Swipe Calculator</div>

        <form action="" class="meal-swipes-form">

            <div class="input-label">Meal swipes remaining:</div>
            <input type="number" id="meals-remaining" class="number-input" required>

            <div class="input-label">Start date (today):</div>
            <input type="date" id="start-date" class="date-input" required>

            <div class="input-label">Final day:</div>
            <input type="date" id="end-date" class="date-input" required>

            <div class="input-label">Select remaining breaks (unless staying on campus):</div>
            <input type="checkbox" id="fall-break"> Fall Break 
            <input type="checkbox" id="turkey-break"> Thanksgiving Break
            <input type="checkbox" id="spring-break"> Spring Break

            <div class="input-label">Estimated swipes for Farmers' Market</div>
            <input type="number" id="farmers" class="number-input">

            <input type="submit" class="submit-button" value="Calculate">
        </form>

    </div>

    <div class="results-container">
        <p class="results-text">
        </p>
    </div>

    <script>
        const form = document.querySelector(".meal-swipes-form");
        
        // form elements + farmerSwipes
        let meals, startDate, endDate, fallBreak, turkeyBreak, springBreak, farmers, farmerSwipes;

        // form elements - dates
        let startDateArray, year, firstMonth, firstDay, endDateArray, lastMonth, lastDay;

        let days;


        function getInputs() {
            meals = parseInt(document.querySelector("#meals-remaining").value);
            startDate = document.querySelector("#start-date").value;
            endDate = document.querySelector("#end-date").value;

            fallBreak = document.querySelector("#fall-break").checked;
            turkeyBreak = document.querySelector("#turkey-break").checked;
            springBreak = document.querySelector("#spring-break").checked;
            farmers = document.querySelector("#farmers").value;

            farmerSwipes = farmers === '' ? 0 : parseInt(farmers);

            startDateArray = startDate.split("-");
            year = parseInt(startDateArray[0]);
            firstMonth = parseInt(startDateArray[1]);
            firstDay = parseInt(startDateArray[2]);

            endDateArray = endDate.split("-");
            lastMonth = parseInt(endDateArray[1]);
            lastDay = parseInt(endDateArray[2]);
        }

        function calculateDays() {
            const daysInMonth = [31, (year % 4 === 0 ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
            
            if (firstMonth === lastMonth) {
                days = lastDay - firstDay;
            } else if (firstMonth + 1 === lastMonth) {
                days = daysInMonth[firstMonth - 1] - firstDay + lastDay;
            } else {
                days = daysInMonth[firstMonth - 1] - firstDay

                for (let i = firstMonth; i < lastMonth; ++i) {
                    days += daysInMonth[i];
                }
                days += lastDay;
            };
        }

        function removeBreakDays() {
            if (fallBreak) {
                days -= 3;
            } 
            if (turkeyBreak) {
                days -= 8; 
            } 
            if (springBreak) {
                days -= 8;
            }
        }

        function removeFarmers() {
            meals -= farmerSwipes;
        }

        function displayResults() {
            console.log(meals);
            const results = document.querySelector('.results-text');
            results.innerHTML = `
                Meals per day: <strong>${(meals / days).toFixed(2)}</strong><br>
                Meals remaining: <strong>${meals}</strong><br>
                Days remaining: <strong>${days}</strong>
            `;
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            getInputs();
            calculateDays();
            removeBreakDays();
            removeFarmers();
            displayResults();
        })

    </script>
</body>
</html>